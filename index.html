<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensure proper scaling on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOM Management System</title>
  <!-- Include html2canvas for previous snapshot code if needed (currently not used) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRcdTCXce1J3DRXnPNskMsafpFYZQROfV/1z6EaWdd+20SfhJ5BjqNfB2ULmMy+jwEZiLJlg+jWkQ2kztC+g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    /* ---------- Base & Reset ---------- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f4f7f9; color: #333; padding: 20px; }

    /* ---------- Header for Admin & Kitchen ---------- */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px 20px;
      background: #007BFF;
      color: #fff;
      border-radius: 6px;
    }
    header h1 { font-size: 1.5rem; }
    header .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    header .header-actions button {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
    }

    /* ---------- Login Page Styles ---------- */
    #login-section {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #e9ecef;
    }
    .login-container {
      display: flex;
      width: 90%;
      max-width: 900px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .login-image {
      flex: 1;
      background: url('kukoo.jpg') no-repeat center center;
      background-size: cover;
      min-height: 300px;
    }
    .login-form-container {
      flex: 1;
      padding: 30px;
    }
    .login-form-container h1 {
      margin-bottom: 20px;
      text-align: center;
    }
    .login-form-container input[type="text"],
    .login-form-container input[type="password"] {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .login-form-container button {
      width: 100%;
      padding: 12px;
      background: #007BFF;
      border: none;
      border-radius: 4px;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    .login-form-container button:hover { background: #0056b3; }

    /* ---------- Dashboard & Navigation ---------- */
    .admin-dashboard {
      text-align: center;
      margin-bottom: 30px;
    }
    .dashboard-cards {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 20px;
    }
    .dashboard-card {
      background: #007BFF;
      color: #fff;
      padding: 20px;
      border-radius: 8px;
      flex: 1;
      min-width: 200px;
    }
    .dashboard-card h2 { margin-bottom: 10px; }
    .dashboard-card p { font-size: 1.5rem; }
    .dashboard-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }
    .dashboard-links button {
      padding: 10px 20px;
      background: #28a745;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
    }
    .dashboard-links button:hover { background: #218838; }
    .back-dashboard {
      display: inline-block;
      margin: 20px auto;
      padding: 10px 20px;
      background: #6c757d;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      font-size: 1rem;
    }
    .back-dashboard:hover { background: #5a6268; }

    /* ---------- Styled Button for "Add New Food Item" ---------- */
    .new-food-item-btn {
      padding: 12px 20px;
      background: #ffc107;
      border: none;
      border-radius: 4px;
      color: #333;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s;
    }
    .new-food-item-btn:hover { background: #e0a800; }

    /* ---------- Container for CRUD Pages ---------- */
    .container {
      max-width: 900px;
      background: #fff;
      margin: 20px auto;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: none;
    }
    h1, h2, h3 { text-align: center; margin-bottom: 20px; }

    /* ---------- Table & Form Styles ---------- */
    form { margin-bottom: 20px; }
    form input[type="text"],
    form input[type="number"],
    form select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    form button {
      padding: 10px 15px;
      background: #007BFF;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
      margin-top: 10px;
    }
    form button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    table thead { background: #007BFF; color: #fff; }
    table th, table td { padding: 10px; text-align: center; border: 1px solid #ddd; }
    .action-btn { margin: 2px; padding: 5px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
    .edit-btn { background: #ffc107; color: #fff; }
    .delete-btn { background: #dc3545; color: #fff; }
    .clear-btn { background: #6c757d; color: #fff; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }

    /* ---------- Ingredient Row ---------- */
    .ingredient-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .ingredient-row input,
    .ingredient-row select {
      flex: 1;
      min-width: 100px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .ingredient-row button {
      background: #dc3545;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .ingredient-row button:hover { background: #b02a37; }

    /* ---------- Search Input ---------- */
    .search-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .search-container input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* ---------- Kitchen Section Styles ---------- */
    #share-container {
      text-align: center;
      margin-top: 20px;
    }
    #share-container button {
      margin: 5px;
      padding: 10px 15px;
      background: #17a2b8;
      border: none;
      border-radius: 4px;
      color: #fff;
      cursor: pointer;
    }
    #share-container button:hover { background: #138496; }

    /* ---------- Responsive ---------- */
    @media (max-width: 600px) {
      .login-container { flex-direction: column; }
      .login-image { height: 200px; }
      .dashboard-cards { flex-direction: column; }
      .back-dashboard { width: 100%; text-align: center; }
      .search-container { flex-direction: column; }
      .search-container input[type="text"] { margin-bottom: 10px; }
    }
  </style>
</head>
<body>
  <!-- ---------- Login Section ---------- -->
  <div id="login-section">
    <div class="login-container">
      <div class="login-image"></div>
      <div class="login-form-container">
        <h1>Login</h1>
        <form id="login-form">
          <input type="text" id="username" placeholder="Username" required />
          <input type="password" id="password" placeholder="Password" required />
          <button type="submit">Login</button>
        </form>
      </div>
    </div>
  </div>

  <!-- ---------- Admin Section ---------- -->
  <div class="container" id="admin-section">
    <!-- Header with Clear Cache and Logout -->
    <header>
      <h1>Admin Dashboard</h1>
      <div class="header-actions">
        <button id="clear-cache-dashboard" class="clear-btn">Clear Cache</button>
        <button id="admin-logout-btn">Logout</button>
      </div>
    </header>
    <!-- Dashboard Summary & Navigation -->
    <div class="admin-dashboard" id="admin-dashboard">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <h2>Item Masters</h2>
          <p id="item-count">0</p>
        </div>
        <div class="dashboard-card">
          <h2>UOM Masters</h2>
          <p id="uom-count">0</p>
        </div>
      </div>
      <div class="dashboard-links">
        <button id="link-items">Manage Items</button>
        <button id="link-uom">Manage UOM</button>
      </div>
    </div>

    <!-- Items Management View -->
    <div id="admin-items-section" style="display: none;">
      <!-- List View Container -->
      <div id="items-list-view">
        <h2>Manage Food Item Masters</h2>
        <div class="search-container">
          <input type="text" id="search-box" placeholder="Search Food Items..." />
        </div>
        <table id="bom-list-table">
          <thead>
            <tr>
              <th>Food Item</th>
              <th>Base Qty</th>
              <th># Ingredients</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Populated dynamically -->
          </tbody>
        </table>
        <button id="show-add-bom" class="new-food-item-btn">Add New Food Item</button>
        <button id="back-to-dashboard1" class="back-dashboard">Back to Dashboard</button>
      </div>
      <!-- Form View Container (for Add/Edit) -->
      <div id="bom-form-section" style="display: none;">
        <h2 id="form-title">Add New Food Item Master</h2>
        <form id="bom-master-form">
          <label for="foodItemName">Food Item Name:</label>
          <input type="text" id="foodItemName" placeholder="e.g., Milkshake" required />
          <label for="baseQty">Base Production Quantity:</label>
          <input type="number" id="baseQty" placeholder="e.g., 100" required />
          <label for="baseUOM">Base UOM:</label>
          <select id="baseUOM" required>
            <option value="">Select UOM</option>
            <!-- Options will be populated from UOM list -->
          </select>
          <div id="ingredients-container">
            <h3>Ingredients</h3>
            <div class="ingredient-row">
              <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
              <input type="number" class="ingredient-qty" placeholder="Quantity" required />
              <select class="ingredient-unit" required>
                <option value="">Select UOM</option>
                <!-- Options will be populated from UOM list -->
              </select>
            </div>
          </div>
          <button type="button" id="add-ingredient">Add Ingredient</button>
          <button type="submit">Save Food Item Master</button>
          <button type="button" id="cancel-add-bom" class="back-dashboard">Back to List</button>
        </form>
      </div>
    </div>

    <!-- UOM Management View -->
    <div id="admin-uom-section" style="display: none;">
      <h2>Manage UOM Masters</h2>
      <ul id="uom-list">
        <!-- UOM items will be listed here -->
      </ul>
      <form id="uom-form">
        <input type="text" id="new-uom" placeholder="Add new UOM (e.g., oz)" required />
        <button type="submit">Add UOM</button>
      </form>
      <button id="back-to-dashboard2" class="back-dashboard">Back to Dashboard</button>
    </div>
  </div>

  <!-- ---------- Kitchen Manager Section ---------- -->
  <div class="container" id="kitchen-section">
    <!-- Header for Kitchen with Clear Cache and Logout -->
    <header>
      <h1>Kitchen Manager</h1>
      <div class="header-actions">
        <button id="clear-cache-kitchen" class="clear-btn">Clear Cache</button>
        <button id="kitchen-logout-btn">Logout</button>
      </div>
    </header>
    <h2>BOM Calculator</h2>
    <form id="bom-calc-form">
      <label for="foodItemSelect">Select Food Item:</label>
      <select id="foodItemSelect" required>
        <option value="">Select Food Item</option>
      </select>
      <label for="prodQty" id="prodQty-label">Enter Production Quantity:</label>
      <input type="number" id="prodQty" placeholder="Enter Production Quantity" required />
      <button type="submit">Calculate BOM</button>
    </form>
    <div id="bom-result"></div>
    <div id="share-container" style="display: none;">
      <button id="share-btn">Share BOM</button>
      <div id="share-options" style="display: none; margin-top: 10px;">
        <button id="share-whatsapp">Share via WhatsApp</button>
        <button id="print-bom">Print BOM</button>
      </div>
    </div>
  </div>

  <script>
    /*********************
     * Data Storage Setup
     *********************/
    // Default Food Item masters (BOMs) with three examples.
    const defaultBOMMaster = {
      milkshake: {
        foodItem: "Milkshake",
        baseQty: 100,
        baseUOM: "ml",
        ingredients: [
          { name: "Milk", qty: 80, unit: "ml" },
          { name: "Ice Cream", qty: 15, unit: "ml" },
          { name: "Sugar", qty: 5, unit: "g" }
        ]
      },
      burger: {
        foodItem: "Burger",
        baseQty: 1,
        baseUOM: "pcs",
        ingredients: [
          { name: "Bun", qty: 1, unit: "pcs" },
          { name: "Patty", qty: 1, unit: "pcs" },
          { name: "Cheese", qty: 1, unit: "pcs" },
          { name: "Lettuce", qty: 15, unit: "g" }
        ]
      },
      pasta: {
        foodItem: "Pasta",
        baseQty: 200,
        baseUOM: "g",
        ingredients: [
          { name: "Pasta", qty: 200, unit: "g" },
          { name: "Tomato Sauce", qty: 100, unit: "ml" },
          { name: "Parmesan Cheese", qty: 20, unit: "g" },
          { name: "Basil", qty: 5, unit: "g" }
        ]
      }
    };
    // Default UOM list
    const defaultUOMList = ["ml", "L", "g", "kg", "pcs"];

    function getBOMMasters() {
      const stored = localStorage.getItem("bomMasters");
      if (stored) { return JSON.parse(stored); }
      else { localStorage.setItem("bomMasters", JSON.stringify(defaultBOMMaster)); return defaultBOMMaster; }
    }
    function saveBOMMasters(bomMasters) { localStorage.setItem("bomMasters", JSON.stringify(bomMasters)); }
    function getUOMList() {
      const stored = localStorage.getItem("uomList");
      if (stored) { return JSON.parse(stored); }
      else { localStorage.setItem("uomList", JSON.stringify(defaultUOMList)); return defaultUOMList; }
    }
    function saveUOMList(uomList) { localStorage.setItem("uomList", JSON.stringify(uomList)); }

    /*********************
     * Login Functionality
     *********************/
    document.getElementById("login-form").addEventListener("submit", function (event) {
      event.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      if (username === "admin" && password === "admin123") {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("admin-section").style.display = "block";
        showDashboard();
      } else if (username === "kitchen" && password === "kitchen123") {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("kitchen-section").style.display = "block";
        populateFoodItems();
      } else { alert("Invalid credentials!"); }
    });

    /*********************
     * Admin Dashboard & Navigation
     *********************/
    function showDashboard() {
      const bomMasters = getBOMMasters();
      document.getElementById("item-count").innerText = Object.keys(bomMasters).length;
      const uomList = getUOMList();
      document.getElementById("uom-count").innerText = uomList.length;
      // Show dashboard; hide other management views
      document.getElementById("admin-dashboard").style.display = "block";
      document.getElementById("admin-items-section").style.display = "none";
      document.getElementById("admin-uom-section").style.display = "none";
    }
    document.getElementById("link-items").addEventListener("click", function () {
      document.getElementById("admin-dashboard").style.display = "none";
      document.getElementById("admin-items-section").style.display = "block";
      // Show list view and hide form view
      document.getElementById("items-list-view").style.display = "block";
      document.getElementById("bom-form-section").style.display = "none";
      renderItemMasterOptions();
      refreshBOMList();
    });
    document.getElementById("link-uom").addEventListener("click", function () {
      document.getElementById("admin-dashboard").style.display = "none";
      document.getElementById("admin-uom-section").style.display = "block";
      renderUOMList();
    });
    document.getElementById("clear-cache-dashboard").addEventListener("click", function () {
      if (confirm("This will clear all stored Food Item Masters. Continue?")) {
        localStorage.removeItem("bomMasters");
        location.reload();
      }
    });
    document.getElementById("admin-logout-btn").addEventListener("click", function () { location.reload(); });
    // Back buttons for admin management
    document.getElementById("back-to-dashboard1").addEventListener("click", showDashboard);
    document.getElementById("back-to-dashboard2").addEventListener("click", showDashboard);

    /*********************
     * Admin: Food Item Masters (CRUD) Management
     *********************/
    let currentEditKey = null;
    function refreshBOMList() {
      const bomMasters = getBOMMasters();
      const tableBody = document.querySelector("#bom-list-table tbody");
      tableBody.innerHTML = "";
      for (const key in bomMasters) {
        if (bomMasters.hasOwnProperty(key)) {
          const bom = bomMasters[key];
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${bom.foodItem}</td>
            <td>${bom.baseQty} ${bom.baseUOM}</td>
            <td>${bom.ingredients.length}</td>
            <td>
              <button class="action-btn edit-btn" data-key="${key}">Edit</button>
              <button class="action-btn delete-btn" data-key="${key}">Delete</button>
            </td>
          `;
          tableBody.appendChild(tr);
        }
      }
    }
    document.getElementById("search-box").addEventListener("input", function () {
      const query = this.value.trim().toLowerCase();
      const rows = document.querySelectorAll("#bom-list-table tbody tr");
      rows.forEach((row) => {
        const foodItem = row.cells[0].textContent.toLowerCase();
        row.style.display = foodItem.indexOf(query) !== -1 ? "" : "none";
      });
    });
    // Show form view when "Add New Food Item" is clicked.
    document.getElementById("show-add-bom").addEventListener("click", function () {
      currentEditKey = null;
      document.getElementById("form-title").innerText = "Add New Food Item Master";
      document.getElementById("items-list-view").style.display = "none";
      document.getElementById("bom-form-section").style.display = "block";
      document.getElementById("bom-master-form").reset();
      resetIngredients();
    });
    // Cancel (Back to List) in form view.
    document.getElementById("cancel-add-bom").addEventListener("click", function () {
      document.getElementById("bom-master-form").reset();
      resetIngredients();
      document.getElementById("bom-form-section").style.display = "none";
      document.getElementById("items-list-view").style.display = "block";
      currentEditKey = null;
    });
    function resetIngredients() {
      const uomOptions = getUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      document.getElementById("ingredients-container").innerHTML = `
        <h3>Ingredients</h3>
        <div class="ingredient-row">
          <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
          <input type="number" class="ingredient-qty" placeholder="Quantity" required />
          <select class="ingredient-unit" required>
            <option value="">Select UOM</option>
            ${uomOptions}
          </select>
        </div>
      `;
    }
    function renderItemMasterOptions() {
      const uomOptions = getUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      document.getElementById("baseUOM").innerHTML = `<option value="">Select UOM</option>${uomOptions}`;
      document.querySelectorAll(".ingredient-unit").forEach(select => {
        select.innerHTML = `<option value="">Select UOM</option>${uomOptions}`;
      });
    }
    // Add Ingredient event listener (simplified and robust)
    document.getElementById("add-ingredient").addEventListener("click", function () {
      const container = document.getElementById("ingredients-container");
      const uomOptions = getUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      const newRow = document.createElement("div");
      newRow.classList.add("ingredient-row");
      newRow.innerHTML = `
        <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
        <input type="number" class="ingredient-qty" placeholder="Quantity" required />
        <select class="ingredient-unit" required>
          <option value="">Select UOM</option>
          ${uomOptions}
        </select>
        <button type="button" class="remove-ingredient">Remove</button>
      `;
      container.appendChild(newRow);
      newRow.querySelector(".remove-ingredient").addEventListener("click", function () {
        newRow.remove();
      });
    });
    document.getElementById("bom-master-form").addEventListener("submit", function (event) {
      event.preventDefault();
      const foodItemName = document.getElementById("foodItemName").value.trim();
      const baseQty = parseFloat(document.getElementById("baseQty").value);
      const baseUOM = document.getElementById("baseUOM").value;
      if (!foodItemName || isNaN(baseQty) || baseQty <= 0 || !baseUOM) {
        alert("Please enter a valid Food Item name, base quantity, and select a base UOM.");
        return;
      }
      const ingredientRows = document.querySelectorAll(".ingredient-row");
      let ingredients = [];
      for (let row of ingredientRows) {
        const name = row.querySelector(".ingredient-name").value.trim();
        const qty = parseFloat(row.querySelector(".ingredient-qty").value);
        const unit = row.querySelector(".ingredient-unit").value;
        if (!name || isNaN(qty) || qty <= 0 || !unit) {
          alert("Please enter valid ingredient details.");
          return;
        }
        ingredients.push({ name, qty, unit });
      }
      let bomMasters = getBOMMasters();
      const key = currentEditKey ? currentEditKey : foodItemName.toLowerCase();
      bomMasters[key] = { foodItem: foodItemName, baseQty: baseQty, baseUOM: baseUOM, ingredients: ingredients };
      saveBOMMasters(bomMasters);
      alert("Food Item Master saved successfully!");
      document.getElementById("bom-master-form").reset();
      resetIngredients();
      document.getElementById("bom-form-section").style.display = "none";
      document.getElementById("items-list-view").style.display = "block";
      refreshBOMList();
      currentEditKey = null;
    });
    document.querySelector("#bom-list-table tbody").addEventListener("click", function (event) {
      const target = event.target;
      if (target.classList.contains("edit-btn")) {
        const key = target.getAttribute("data-key");
        const bomMasters = getBOMMasters();
        const bom = bomMasters[key];
        if (bom) {
          currentEditKey = key;
          document.getElementById("form-title").innerText = "Edit Food Item Master";
          document.getElementById("foodItemName").value = bom.foodItem;
          document.getElementById("baseQty").value = bom.baseQty;
          document.getElementById("baseUOM").value = bom.baseUOM;
          const container = document.getElementById("ingredients-container");
          container.innerHTML = "<h3>Ingredients</h3>";
          bom.ingredients.forEach((ing) => {
            const row = document.createElement("div");
            row.classList.add("ingredient-row");
            row.innerHTML = `
              <input type="text" class="ingredient-name" placeholder="Ingredient Name" required value="${ing.name}" />
              <input type="number" class="ingredient-qty" placeholder="Quantity" required value="${ing.qty}" />
              <select class="ingredient-unit" required>
                <option value="">Select UOM</option>
                ${getUOMList().map(uom => `<option value="${uom}" ${ing.unit === uom ? "selected" : ""}>${uom}</option>`).join("")}
              </select>
              <button type="button" class="remove-ingredient">Remove</button>
            `;
            container.appendChild(row);
            row.querySelector(".remove-ingredient").addEventListener("click", function () {
              row.remove();
            });
          });
          document.getElementById("items-list-view").style.display = "none";
          document.getElementById("bom-form-section").style.display = "block";
        }
      } else if (target.classList.contains("delete-btn")) {
        const key = target.getAttribute("data-key");
        if (confirm("Are you sure you want to delete this Food Item Master?")) {
          let bomMasters = getBOMMasters();
          delete bomMasters[key];
          saveBOMMasters(bomMasters);
          refreshBOMList();
        }
      }
    });

    /*********************
     * Admin: UOM Management (CRUD)
     *********************/
    function renderUOMList() {
      const uomList = getUOMList();
      const uomListContainer = document.getElementById("uom-list");
      uomListContainer.innerHTML = "";
      uomList.forEach((uom, index) => {
        const li = document.createElement("li");
        li.style.marginBottom = "10px";
        li.textContent = uom + " ";
        const delBtn = document.createElement("button");
        delBtn.textContent = "Delete";
        delBtn.className = "clear-btn";
        delBtn.style.padding = "5px 10px";
        delBtn.addEventListener("click", function () {
          if (confirm(`Delete UOM "${uom}"?`)) {
            const updated = uomList.filter((_, i) => i !== index);
            saveUOMList(updated);
            renderUOMList();
          }
        });
        li.appendChild(delBtn);
        uomListContainer.appendChild(li);
      });
    }
    document.getElementById("uom-form").addEventListener("submit", function (event) {
      event.preventDefault();
      const newUOM = document.getElementById("new-uom").value.trim();
      if (!newUOM) { alert("Enter a valid UOM."); return; }
      const uomList = getUOMList();
      if (uomList.includes(newUOM)) { alert("UOM already exists!"); return; }
      uomList.push(newUOM);
      saveUOMList(uomList);
      document.getElementById("new-uom").value = "";
      renderUOMList();
    });

    /*********************
     * Kitchen Manager: BOM Calculation & Share Options
     *********************/
    document.getElementById("bom-calc-form").addEventListener("submit", function (event) {
      event.preventDefault();
      const foodItemKey = document.getElementById("foodItemSelect").value;
      const prodQty = parseFloat(document.getElementById("prodQty").value);
      if (!foodItemKey) { alert("Please select a food item."); return; }
      if (isNaN(prodQty) || prodQty <= 0) { alert("Please enter a valid production quantity."); return; }
      const bomMasters = getBOMMasters();
      const bom = bomMasters[foodItemKey];
      if (!bom) { alert("Food Item Master not found."); return; }
      const factor = prodQty / bom.baseQty;
      let resultHTML = `<h2>BOM for ${bom.foodItem} (${prodQty} ${bom.baseUOM})</h2>`;
      resultHTML += `
        <table>
          <thead>
            <tr>
              <th>Ingredient</th>
              <th>Quantity</th>
              <th>Unit</th>
            </tr>
          </thead>
          <tbody>
      `;
      bom.ingredients.forEach((ing) => {
        const scaledQty = ing.qty * factor;
        resultHTML += `
          <tr>
            <td>${ing.name}</td>
            <td>${scaledQty.toFixed(2)}</td>
            <td>${ing.unit}</td>
          </tr>
        `;
      });
      resultHTML += "</tbody></table>";
      document.getElementById("bom-result").innerHTML = resultHTML;
      document.getElementById("share-container").style.display = "block";
      document.getElementById("share-options").style.display = "none";
    });
    function populateFoodItems() {
      const bomMasters = getBOMMasters();
      const select = document.getElementById("foodItemSelect");
      select.innerHTML = `<option value="">Select Food Item</option>`;
      for (const key in bomMasters) {
        if (bomMasters.hasOwnProperty(key)) {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = bomMasters[key].foodItem;
          select.appendChild(option);
        }
      }
    }
    document.getElementById("foodItemSelect").addEventListener("change", function () {
      const selectedKey = this.value;
      const prodQtyLabel = document.getElementById("prodQty-label");
      if (selectedKey) {
        const bom = getBOMMasters()[selectedKey];
        if (bom) { prodQtyLabel.innerText = `Enter Production Quantity (in ${bom.baseUOM}):`; }
      } else { prodQtyLabel.innerText = "Enter Production Quantity:"; }
    });
    // Original Share logic: Share BOM text via WhatsApp and Print BOM
    document.getElementById("share-btn").addEventListener("click", function () {
      const options = document.getElementById("share-options");
      options.style.display = options.style.display === "none" ? "block" : "none";
    });
    document.getElementById("share-whatsapp").addEventListener("click", function () {
      const bomText = document.getElementById("bom-result").innerText;
      const url = "https://api.whatsapp.com/send?text=" + encodeURIComponent(bomText);
      window.open(url, "_blank");
    });
    document.getElementById("print-bom").addEventListener("click", function () {
      window.print();
    });
    document.getElementById("clear-cache-kitchen").addEventListener("click", function () {
      if (confirm("This will clear all stored Food Item Masters. Continue?")) {
        localStorage.removeItem("bomMasters");
        location.reload();
      }
    });
    document.getElementById("kitchen-logout-btn").addEventListener("click", function () { location.reload(); });
  </script>
</body>
</html>
