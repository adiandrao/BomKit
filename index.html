<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kitchen Management System</title>
  <!-- html2canvas included for fallback sharing (not used in our final share logic) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" 
          integrity="sha512-BNaRcdTCXce1J3DRXnPNskMsafpFYZQROfV/1z6EaWdd+20SfhJ5BjqNfB2ULmMy+jwEZiLJlg+jWkQ2kztC+g==" 
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <style>
    /* ---------- Base & Reset ---------- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f4f7f9; color: #333; padding: 20px; }
    
    /* ---------- Header (Admin & Kitchen) ---------- */
    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 20px; background: #007BFF; color: #fff; border-radius: 6px;
      margin-bottom: 20px;
    }
    header h1 { font-size: 1.5rem; }
    .header-actions { display: flex; gap: 15px; align-items: center; }
    .header-actions button { background: none; border: none; color: #fff; cursor: pointer; font-size: 1rem; }
    
    /* ---------- Login Section ---------- */
    #login-section {
      display: flex; align-items: center; justify-content: center; height: 100vh; background: #e9ecef;
    }
    .login-container {
      display: flex; width: 90%; max-width: 900px; background: #fff; border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden;
    }
    .login-image {
      flex: 1; background: url('kukoo.jpg') no-repeat center center; background-size: cover; min-height: 300px;
    }
    .login-form-container { flex: 1; padding: 30px; }
    .login-form-container h1 { margin-bottom: 20px; text-align: center; }
    .login-form-container input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }
    .login-form-container button {
      width: 100%; padding: 12px; background: #007BFF; border: none; border-radius: 4px;
      color: #fff; font-size: 1rem; cursor: pointer;
    }
    .login-form-container button:hover { background: #0056b3; }
    
    /* ---------- Admin Dashboard & Navigation ---------- */
    .admin-dashboard { text-align: center; margin-bottom: 30px; }
    .dashboard-cards { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
    .dashboard-card {
      background: #007BFF; color: #fff; padding: 20px; border-radius: 8px; flex: 1; min-width: 200px;
    }
    .dashboard-card h2 { margin-bottom: 10px; }
    .dashboard-card p { font-size: 1.5rem; }
    .dashboard-links, .admin-extra-links { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .dashboard-links button, .admin-extra-links button {
      padding: 10px 20px; background: #28a745; border: none; border-radius: 4px; color: #fff; cursor: pointer; font-size: 1rem;
    }
    .dashboard-links button:hover { background: #218838; }
    .admin-extra-links button { background: #17a2b8; }
    .admin-extra-links button:hover { background: #138496; }
    .back-dashboard {
      display: inline-block; margin: 20px auto; padding: 10px 20px;
      background: #6c757d; border: none; border-radius: 4px; color: #fff; cursor: pointer; font-size: 1rem;
    }
    .back-dashboard:hover { background: #5a6268; }
    
    /* ---------- Styled Button for "Add New Food Item" ---------- */
    .new-food-item-btn {
      padding: 12px 20px; background: #ffc107; border: none; border-radius: 4px; color: #333;
      font-size: 1rem; cursor: pointer; margin-top: 10px; transition: background 0.3s;
    }
    .new-food-item-btn:hover { background: #e0a800; }
    
    /* ---------- Kitchen Navigation ---------- */
    .kitchen-nav { text-align: center; margin-bottom: 20px; }
    .kitchen-nav button {
      padding: 10px 20px; background: #17a2b8; border: none; border-radius: 4px; color: #fff;
      cursor: pointer; font-size: 1rem; margin: 0 10px;
    }
    .kitchen-nav button.active { background: #138496; }
    .kitchen-nav button:hover { background: #138496; }
    
    /* ---------- Containers for Management Views ---------- */
    .container {
      max-width: 900px; background: #fff; margin: 20px auto; padding: 20px;
      border-radius: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: none;
    }
    h1, h2, h3 { text-align: center; margin-bottom: 20px; }
    
    /* ---------- Table & Form Styles ---------- */
    form { margin-bottom: 20px; }
    form input, form select {
      width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px;
    }
    form button {
      padding: 10px 15px; background: #007BFF; border: none; border-radius: 4px; color: #fff;
      cursor: pointer; margin-top: 10px;
    }
    form button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
    table thead { background: #007BFF; color: #fff; }
    table th, table td { padding: 10px; text-align: center; border: 1px solid #ddd; }
    .action-btn { margin: 2px; padding: 5px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; }
    .edit-btn { background: #ffc107; color: #fff; }
    .delete-btn { background: #dc3545; color: #fff; }
    .clear-btn { background: #6c757d; color: #fff; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; }
    
    /* ---------- Ingredient Row (in Food Item Form) ---------- */
    .ingredient-row {
      display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;
    }
    .ingredient-row input, .ingredient-row select {
      flex: 1; min-width: 100px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    }
    .ingredient-row button {
      background: #dc3545; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;
    }
    .ingredient-row button:hover { background: #b02a37; }
    
    /* ---------- Process Step Row (in Process Master Form) ---------- */
    .process-step-row {
      display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;
    }
    .process-step-row input {
      flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    }
    .process-step-row button {
      background: #dc3545; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;
    }
    .process-step-row button:hover { background: #b02a37; }
    
    /* ---------- Kitchen Section Styles ---------- */
    #share-container { text-align: center; margin-top: 20px; }
    #share-container button { margin: 5px; padding: 10px 15px; background: #17a2b8; border: none; border-radius: 4px; color: #fff; cursor: pointer; }
    #share-container button:hover { background: #138496; }
    
    /* ---------- Cook Food View Styles ---------- */
    .quantity-line { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .quantity-line input[type="number"] { flex: 1; }
    .quantity-line span { font-weight: bold; font-size: 1rem; }
    /* Table for process steps with Start/Stop buttons */
    #process-steps-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    #process-steps-table th, #process-steps-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    #process-steps-table th { background: #007BFF; color: #fff; }
    /* Start/Stop buttons styling */
    .start-btn, .stop-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .start-btn {
      background: #28a745;
      color: #fff;
    }
    .start-btn:hover {
      background: #218838;
    }
    .stop-btn {
      background: #dc3545;
      color: #fff;
    }
    .stop-btn:hover {
      background: #c82333;
    }
    /* Disabled state: change color */
    .start-btn:disabled, .stop-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    /* Share Process button styling */
    #cook-share-btn {
      padding: 10px 15px;
      background: #ffc107;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #cook-share-btn:hover {
      background: #e0a800;
    }
    #cook-share-whatsapp, #cook-print {
    padding: 10px 15px;
    background: #17a2b8;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin: 5px;
    }
    #cook-share-whatsapp:hover, #cook-print:hover {
    background: #138496;
    }
    .kitchen-back-btn {
      display: inline-block; margin: 20px auto; padding: 10px 20px;
      background: #6c757d; border: none; border-radius: 4px; color: #fff; cursor: pointer; font-size: 1rem;
    }
    .kitchen-back-btn:hover { background: #5a6268; }
    
    /* ---------- Utility Classes ---------- */
    .hidden { display: none; }
    
    /* ---------- Responsive ---------- */
    @media (max-width: 600px) {
      .login-container { flex-direction: column; }
      .login-image { height: 200px; }
      .dashboard-cards, .kitchen-nav { flex-direction: column; }
      .back-dashboard, .kitchen-back-btn { width: 100%; text-align: center; }
      .kitchen-nav button { margin-bottom: 10px; }
    }
  </style>
</head>
<body>

<! ------------------ Login Functionality ------------------ >
 <script type="module">
  // Import Firebase SDK (v11.3.1)
  // ✅ Import Firebase SDK (Including getApps)
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

  // Firebase Configuration (Replace with your credentials)
  import { firebaseConfig } from "./firebaseConfig.js";


  // Initialize Firebase
  // ✅ Only initialize if Firebase App doesn't already exist
  const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
  console.log("Firebase App Status:", app); // Debugging

  const auth = getAuth(app);
   onAuthStateChanged(auth, (user) => {
  if (user) {
    console.log("✅ User is logged in:", user.uid);
  } else {
    console.log("❌ No user logged in - Firestore access will fail");
  }
});

   async function loginUser(email, password) {
  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    console.log("✅ Login Success:", userCredential.user);
  } catch (error) {
    console.error("❌ Login Failed:", error.code, "-", error.message);
    alert("Login Failed: " + error.message);
  }
}

loginUser("hanuma@adiandrao.com", "adi.2017"); // ✅ Replace with actual credentials
   
  const db = getFirestore(app);

  // Function to display error messages in the UI
  function showError(message) {
    const errorDiv = document.getElementById("error-message");
    errorDiv.innerText = message;
    errorDiv.style.display = "block"; // Make the error message visible
  }

  // Login Functionality using Firebase Authentication
  document.getElementById("login-form").addEventListener("submit", async (event) => {
    event.preventDefault(); // Prevent default form submission

    const email = document.getElementById("username").value.trim(); // Get user email input
    const password = document.getElementById("password").value.trim(); // Get user password input

    try {
      // Authenticate user with Firebase Authentication
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user; // Extract authenticated user details
      console.log("✅ Login Success:", user);
    alert("Login Successful!");
  } catch (error) {
    console.error("❌ Login Failed:", error.code, error.message);
    alert("Login Failed: " + error.message);
  }
});

      // Retrieve user role from Firestore using UID as document ID
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        const userData = userDoc.data(); // Extract user role information
        
        // Show respective dashboard based on user role
        if (userData.role === "admin") {
          document.getElementById("login-section").style.display = "none";
          document.getElementById("admin-section").style.display = "block";
        } else if (userData.role === "kitchen") {
          document.getElementById("login-section").style.display = "none";
          document.getElementById("kitchen-section").style.display = "block";
        } else {
          showError("Unknown role. Contact admin.");
        }
      } else {
        showError("User role not found in Firestore! Please contact admin.");
      }
    } catch (error) {
      showError("Login failed: " + error.message); // Display authentication errors
    }
  });

  // Logout Functionality for Admin
  document.getElementById("admin-logout-btn").addEventListener("click", async () => {
    await signOut(auth); // Sign out the user
    location.reload(); // Refresh the page
  });

  // Logout Functionality for Kitchen
  document.getElementById("kitchen-logout-btn").addEventListener("click", async () => {
    await signOut(auth); // Sign out the user
    location.reload(); // Refresh the page
  });

  //...................Master Management......................
     // ✅ Fetch and Render masters from Firestore

   // ✅ Fetch Food Items in Real-Time
function fetchFoodItems() {
  try {
  onSnapshot(collection(db, "food_items"), (snapshot) => {
    const foodItems = {};
    snapshot.forEach((doc) => {
      foodItems[doc.id] = doc.data();
    });
    renderFoodItems(foodItems); // Call UI update function
  });
} catch (error) {
    console.error("❌ Firestore Error:", error);
    alert("Failed to fetch food items. Please check Firestore rules.");
  }
}

// ✅ Fetch UOM List
function fetchUOMList() {
  try { 
  onSnapshot(collection(db, "uom_list"), (snapshot) => {
    const uomList = snapshot.docs.map(doc => doc.data().name);
    renderUOMList(uomList);
  });
} catch (error) {
    console.error("Firestore Error:", error);
    alert("Failed to fetch UOM List. Please check Firestore rules.");
  }
}

// ✅ Fetch Process Masters in Real-Time
function fetchProcessMasters() {
   try {
  onSnapshot(collection(db, "process_masters"), (snapshot) => {
    const processMasters = {};
    snapshot.forEach((doc) => {
      processMasters[doc.id] = doc.data();
    });
    renderProcessMasters(processMasters);
  });
} catch (error) {
    console.error("Firestore Error:", error);
    alert("Failed to fetch Process Masters. Please check Firestore rules.");
  }
}

 
// ✅ Call this function when the page loads
fetchFoodItems();
fetchUOMList();
fetchProcessMasters();

   
//...................Render Masters.................   
  function renderFoodItems(foodItems) {
  const tbody = document.querySelector("#bom-list-table tbody");
  tbody.innerHTML = "";

  Object.keys(foodItems).forEach((key) => {
    const foodItem = foodItems[key];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${foodItem.name}</td>
      <td>${foodItem.baseQty} ${foodItem.baseUOM}</td>
      <td>${foodItem.ingredients.length}</td>
      <td>
        <button class="action-btn edit-btn" onclick="editFoodItem('${key}')">Edit</button>
        <button class="action-btn delete-btn" onclick="deleteFoodItem('${key}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
   
   function renderUOMList() {
  onSnapshot(collection(db, "uom_list"), (snapshot) => {
    const ul = document.getElementById("uom-list");
    ul.innerHTML = ""; // Clear the existing list before updating

    snapshot.forEach((doc) => {
      const uom = doc.data().name;
      const li = document.createElement("li");
      li.innerHTML = `
        ${uom} 
        <button class="clear-btn" onclick="deleteUOM('${doc.id}')">Delete</button>
      `;
      ul.appendChild(li);
    });
  });
}

   function renderProcessMasters(processMasters) {
      const tbody = document.getElementById("process-table-body");
  tbody.innerHTML = "";

  Object.keys(processMasters).forEach((key) => {
    const proc = processMasters[key];
    const stepsText = proc.steps.join("<br>");
    
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${proc.foodItem}</td>
      <td>${stepsText}</td>
      <td>
        <button class="action-btn edit-btn" onclick="editProcess('${key}')">Edit</button>
        <button class="action-btn delete-btn" onclick="deleteProcess('${key}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

//...................Manage Delete Masters................. 
async function deleteUOM(uomId) {
  if (confirm("Are you sure you want to delete this UOM?")) {
    await deleteDoc(doc(db, "uom_list", uomId));
    alert("UOM deleted successfully!");
  }
}

async function deleteFoodItem(foodItemId) {
  if (confirm("Are you sure you want to delete this food item?")) {
    await deleteDoc(doc(db, "food_items", foodItemId));
    alert("Food Item deleted successfully!");
  }
}

async function deleteprocessmaster(processmasterId) {
  if (confirm("Are you sure you want to delete this processmaster?")) {
    await deleteDoc(doc(db, "process_masters", processmasterId));
    alert("Process master deleted successfully!");
  }
}
  
   
   
   
 </script>

<!-- Error Message Display -->
<div id="error-message" style="color: red; display: none; text-align: center; margin-top: 10px;"></div>

  
  <!-- ---------- Login Section ---------- -->
  <div id="login-section">
    <div class="login-container">
      <div class="login-image"></div>
      <div class="login-form-container">
        <h1>Login</h1>
        <form id="login-form">
          <input type="text" id="username" placeholder="Username" required />
          <input type="password" id="password" placeholder="Password" required />
          <button type="submit">Login</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- ---------- Admin Section ---------- -->
  <div id="admin-section" class="container">
    <header>
      <h1>Admin Dashboard</h1>
      <div class="header-actions">
        <button id="clear-cache-dashboard" class="clear-btn">Clear Cache</button>
        <button id="admin-logout-btn">Logout</button>
      </div>
    </header>
    <div id="admin-dashboard" class="admin-dashboard">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <h2>Item Masters</h2>
          <p id="item-count">0</p>
        </div>
        <div class="dashboard-card">
          <h2>UOM Masters</h2>
          <p id="uom-count">0</p>
        </div>
        <div class="dashboard-card">
          <h2>Process Masters</h2>
          <p id="process-count">0</p>
        </div>
      </div>
      <div class="dashboard-links">
        <button id="link-items">Manage Items</button>
        <button id="link-uom">Manage UOM</button>
      </div>
      <div class="admin-extra-links">
        <button id="link-process">Manage Process Masters</button>
      </div>
    </div>
    
    <!-- Manage Food Items -->
    <div id="admin-items-section" class="hidden">
      <div id="items-list-view">
        <h2>Manage Food Item Masters</h2>
        <div class="search-container">
          <input type="text" id="search-box" placeholder="Search Food Items..." />
        </div>
        <table id="bom-list-table">
          <thead>
            <tr>
              <th>Food Item</th>
              <th>Base Qty</th>
              <th># Ingredients</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button id="show-add-bom" class="new-food-item-btn">Add New Food Item</button>
        <button id="back-to-dashboard1" class="back-dashboard">Back to Dashboard</button>
      </div>
      <div id="bom-form-section" class="hidden">
        <h2 id="form-title">Add New Food Item Master</h2>
        <form id="bom-master-form">
          <label for="foodItemName">Food Item Name:</label>
          <input type="text" id="foodItemName" placeholder="e.g., Milkshake" required />
          <label for="baseQty">Base Production Quantity:</label>
          <input type="number" id="baseQty" placeholder="e.g., 100" required />
          <label for="baseUOM">Base UOM:</label>
          <select id="baseUOM" required>
            <option value="">Select UOM</option>
          </select>
          <div id="ingredients-container">
            <h3>Ingredients</h3>
            <div class="ingredient-row">
              <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
              <input type="number" class="ingredient-qty" placeholder="Quantity" required />
              <select class="ingredient-unit" required>
                <option value="">Select UOM</option>
              </select>
              <button type="button" class="remove-ingredient">Remove</button>
            </div>
          </div>
          <button type="button" id="add-ingredient" class="new-food-item-btn">Add Ingredient</button>
          <button type="submit">Save Food Item Master</button>
          <button type="button" id="cancel-add-bom" class="back-dashboard">Back to List</button>
        </form>
      </div>
    </div>
    
    <!-- Manage UOM -->
    <div id="admin-uom-section" class="hidden">
      <h2>Manage UOM Masters</h2>
      <ul id="uom-list"></ul>
      <form id="uom-form">
        <input type="text" id="new-uom" placeholder="Add new UOM (e.g., oz)" required />
        <button type="submit">Add UOM</button>
      </form>
      <button id="back-to-dashboard2" class="back-dashboard">Back to Dashboard</button>
    </div>
    
    <!-- Manage Process Masters -->
    <div id="admin-process-section" class="hidden">
      <h2>Manage Process Masters</h2>
      <table id="process-table">
        <thead>
          <tr>
            <th>Food Item</th>
            <th>Process Steps</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="process-table-body"></tbody>
      </table>
      <button id="show-add-process" class="new-food-item-btn">Add New Process Master</button>
      <button id="back-to-dashboard3" class="back-dashboard">Back to Dashboard</button>
    </div>
    
    <!-- Process Master Form -->
    <div id="process-form-section" class="hidden">
      <h2 id="process-form-title">Add New Process Master</h2>
      <form id="process-master-form">
        <!-- Food Item is now a dropdown populated from BOM masters -->
        <label for="processFoodItem">Select Food Item:</label>
        <select id="processFoodItem" required>
          <option value="">Select Food Item</option>
        </select>
        <div id="process-steps-container" class="process-steps-container">
          <h3>Process Steps</h3>
          <div class="process-step-row">
            <input type="text" class="process-step" placeholder="Step description" required>
            <button type="button" class="remove-process-step">Remove</button>
          </div>
        </div>
        <button type="button" id="add-process-step" class="new-food-item-btn">Add Process Step</button>
        <button type="submit">Save Process Master</button>
        <button type="button" id="cancel-add-process" class="back-dashboard">Back to List</button>
      </form>
    </div>
  </div>
  
  <!-- ---------- Kitchen Section ---------- -->
  <div id="kitchen-section" class="container">
    <header>
      <h1>Kitchen Manager</h1>
      <div class="header-actions">
        <button id="clear-cache-kitchen" class="clear-btn">Clear Cache</button>
        <button id="kitchen-logout-btn">Logout</button>
      </div>
    </header>
    <div class="kitchen-nav">
      <button id="kitchen-itemlist-btn" class="active">Item List Calculator</button>
      <button id="kitchen-cook-btn">Cook Food</button>
    </div>
    <!-- Item List Calculator View -->
    <div id="kitchen-calc-section">
      <h2>Item List Calculator</h2>
      <form id="bom-calc-form">
        <label for="foodItemSelect">Select Food Item:</label>
        <select id="foodItemSelect" required>
          <option value="">Select Food Item</option>
        </select>
        <label for="prodQty" id="prodQty-label">Enter Production Quantity:</label>
        <input type="number" id="prodQty" placeholder="Enter Production Quantity" required />
        <button type="submit">Calculate Item List</button>
      </form>
      <div id="bom-result"></div>
      <div id="share-container" class="hidden">
        <button id="share-btn">Share Item List</button>
        <div id="share-options" class="hidden" style="margin-top:10px;">
          <button id="share-whatsapp">Share via WhatsApp</button>
          <button id="print-bom">Print Item List</button>
        </div>
      </div>
    </div>
    <!-- Cook Food View -->
    <div id="kitchen-cook-section" class="hidden">
      <h2>Cook Food</h2>
      <form id="cook-form">
        <label for="cookFoodItem">Select Food Item:</label>
        <select id="cookFoodItem" required>
          <option value="">Select Food Item</option>
        </select>
        <div class="quantity-line">
          <label for="cookQty">Quantity to Cook:</label>
          <input type="number" id="cookQty" placeholder="Enter quantity" required />
          <span id="cookUOM"></span>
        </div>
        <button type="submit">Generate Cooking Process</button>
      </form>
      <div id="process-display" class="hidden">
        <h3>Cooking Process</h3>
        <table id="process-steps-table">
          <thead>
            <tr>
              <th>Process Step</th>
              <th>Start</th>
              <th>Stop</th>
              <th>Time Taken (sec)</th>
            </tr>
          </thead>
          <tbody id="process-steps-body"></tbody>
        </table>
        <div id="total-cook-time" style="margin-top:10px; font-weight:bold;">Total Cooking Time: 0.0 sec</div>
        <div id="cook-share-container" style="margin-top:10px;">
          <button id="cook-share-btn">Share Process</button>
          <div id="cook-share-options" class="hidden" style="margin-top:10px;">
            <button id="cook-share-whatsapp">Share via WhatsApp</button>
            <button id="cook-print">Print Process</button>
          </div>
        </div>
        <button id="back-to-kitchen-menu" class="kitchen-back-btn">Back to Menu</button>
      </div>
    </div>
  </div>
  
  <script>
    /* ------------------ Data Storage Setup ------------------ */
    const defaultBOMMaster = {
      milkshake: { foodItem: "Milkshake", baseQty: 100, baseUOM: "ml", ingredients: [ { name: "Milk", qty: 80, unit: "ml" }, { name: "Ice Cream", qty: 15, unit: "ml" }, { name: "Sugar", qty: 5, unit: "g" } ] },
      burger: { foodItem: "Burger", baseQty: 1, baseUOM: "pcs", ingredients: [ { name: "Bun", qty: 1, unit: "pcs" }, { name: "Patty", qty: 1, unit: "pcs" }, { name: "Cheese", qty: 1, unit: "pcs" }, { name: "Lettuce", qty: 15, unit: "g" } ] },
      pasta: { foodItem: "Pasta", baseQty: 200, baseUOM: "g", ingredients: [ { name: "Pasta", qty: 200, unit: "g" }, { name: "Tomato Sauce", qty: 100, unit: "ml" }, { name: "Parmesan Cheese", qty: 20, unit: "g" }, { name: "Basil", qty: 5, unit: "g" } ] }
    };
    const defaultUOMList = ["ml", "L", "g", "kg", "pcs"];
    const defaultProcessMasters = {
      milkshake: { processes: ["Add Milk, Ice Cream, and Sugar to the blender", "Blend until smooth", "Pour into a glass and serve"] },
      burger: { processes: ["Toast the bun", "Grill the patty", "Assemble the burger with cheese and lettuce", "Serve immediately"] },
      pasta: { processes: ["Boil pasta until al dente", "Heat tomato sauce", "Mix pasta with sauce", "Top with Parmesan and basil", "Serve warm"] }
    };
    
       
    /* ------------------ Admin Dashboard & Navigation ------------------ */
    function showDashboard() {
      const bomMasters = fetchFoodItems();
      document.getElementById("item-count").innerText = Object.keys(bomMasters).length;
      const uomList = fetchUOMList();
      document.getElementById("uom-count").innerText = uomList.length;
      const processMasters = fetchProcessMasters();
      document.getElementById("process-count").innerText = Object.keys(processMasters).length;
      document.getElementById("admin-dashboard").style.display = "block";
      document.getElementById("admin-items-section").classList.add("hidden");
      document.getElementById("admin-uom-section").classList.add("hidden");
      document.getElementById("admin-process-section").classList.add("hidden");
    }
    document.getElementById("link-items").addEventListener("click", function() {
      document.getElementById("admin-dashboard").style.display = "none";
      document.getElementById("admin-items-section").classList.remove("hidden");
      document.getElementById("items-list-view").classList.remove("hidden");
      document.getElementById("bom-form-section").classList.add("hidden");
      renderItemMasterOptions();
      refreshBOMList();
    });
    document.getElementById("link-uom").addEventListener("click", function() {
      document.getElementById("admin-dashboard").style.display = "none";
      document.getElementById("admin-uom-section").classList.remove("hidden");
      renderUOMList();
    });
    document.getElementById("link-process").addEventListener("click", function() {
      document.getElementById("admin-dashboard").style.display = "none";
      document.getElementById("admin-process-section").classList.remove("hidden");
      populateProcessFoodItems();
      renderProcessMasters();
    });
    document.getElementById("clear-cache-dashboard").addEventListener("click", function() {
      if (confirm("This will clear all stored Food Item Masters. Continue?")) {
        localStorage.removeItem("bomMasters");
        location.reload();
      }
    });
    document.getElementById("admin-logout-btn").addEventListener("click", function() { location.reload(); });
    document.getElementById("back-to-dashboard1").addEventListener("click", showDashboard);
    document.getElementById("back-to-dashboard2").addEventListener("click", showDashboard);
    document.getElementById("back-to-dashboard3").addEventListener("click", showDashboard);
    
    /* ------------------ Admin: Manage Food Items ------------------ */
    let currentEditKey = null;

    function refreshBOMList(foodItems) {
  const tbody = document.querySelector("#bom-list-table tbody");
  tbody.innerHTML = "";

  Object.keys(foodItems).forEach((key) => {
    const foodItem = foodItems[key];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${foodItem.name}</td>
      <td>${foodItem.baseQty} ${foodItem.baseUOM}</td>
      <td>${foodItem.ingredients.length}</td>
      <td>
        <button class="action-btn edit-btn" onclick="editFoodItem('${key}')">Edit</button>
        <button class="action-btn delete-btn" onclick="deleteFoodItem('${key}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
    
    document.getElementById("search-box").addEventListener("input", function() {
      const query = this.value.trim().toLowerCase();
      const rows = document.querySelectorAll("#bom-list-table tbody tr");
      rows.forEach(row => {
        const foodItem = row.cells[0].textContent.toLowerCase();
        row.style.display = foodItem.indexOf(query) !== -1 ? "" : "none";
      });
    });
    document.getElementById("show-add-bom").addEventListener("click", function() {
      currentEditKey = null;
      document.getElementById("form-title").innerText = "Add New Food Item Master";
      document.getElementById("items-list-view").classList.add("hidden");
      document.getElementById("bom-form-section").classList.remove("hidden");
      document.getElementById("bom-master-form").reset();
      resetIngredients();
    });
    document.getElementById("cancel-add-bom").addEventListener("click", function() {
      document.getElementById("bom-master-form").reset();
      resetIngredients();
      document.getElementById("bom-form-section").classList.add("hidden");
      document.getElementById("items-list-view").classList.remove("hidden");
      currentEditKey = null;
    });
    function resetIngredients() {
      const container = document.getElementById("ingredients-container");
      container.innerHTML = `
        <h3>Ingredients</h3>
        <div class="ingredient-row">
          <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
          <input type="number" class="ingredient-qty" placeholder="Quantity" required />
          <select class="ingredient-unit" required>
            <option value="">Select UOM</option>
          </select>
          <button type="button" class="remove-ingredient">Remove</button>
        </div>
      `;
      const defaultSelect = container.querySelector(".ingredient-unit");
      defaultSelect.innerHTML = `<option value="">Select UOM</option>` + fetchUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      container.querySelector(".remove-ingredient").addEventListener("click", function() {
        const row = this.closest(".ingredient-row");
        if(row) row.remove();
      });
    }
    function renderItemMasterOptions() {
      const uomOptions = fetchUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      document.getElementById("baseUOM").innerHTML = `<option value="">Select UOM</option>${uomOptions}`;
      document.querySelectorAll(".ingredient-unit").forEach(select => {
        select.innerHTML = `<option value="">Select UOM</option>${uomOptions}`;
      });
    }
    function createIngredientRow() {
      const uomOptions = fetchUOMList().map(uom => `<option value="${uom}">${uom}</option>`).join("");
      const row = document.createElement("div");
      row.className = "ingredient-row";
      row.innerHTML = `
        <input type="text" class="ingredient-name" placeholder="Ingredient Name" required />
        <input type="number" class="ingredient-qty" placeholder="Quantity" required />
        <select class="ingredient-unit" required>
          <option value="">Select UOM</option>
          ${uomOptions}
        </select>
        <button type="button" class="remove-ingredient">Remove</button>
      `;
      row.querySelector(".remove-ingredient").addEventListener("click", function() {
        row.remove();
      });
      return row;
    }
    document.getElementById("add-ingredient").addEventListener("click", function() {
      const container = document.getElementById("ingredients-container");
      const newRow = createIngredientRow();
      container.appendChild(newRow);
    });
    document.getElementById("bom-master-form").addEventListener("submit", function(event) {
      event.preventDefault();
      const foodItemName = document.getElementById("foodItemName").value.trim();
      const baseQty = parseFloat(document.getElementById("baseQty").value);
      const baseUOM = document.getElementById("baseUOM").value;
      if (!foodItemName || isNaN(baseQty) || baseQty <= 0 || !baseUOM) {
        alert("Please enter a valid Food Item name, base quantity, and select a base UOM.");
        return;
      }
      const ingredientRows = document.querySelectorAll(".ingredient-row");
      let ingredients = [];
      for (let row of ingredientRows) {
        const name = row.querySelector(".ingredient-name").value.trim();
        const qty = parseFloat(row.querySelector(".ingredient-qty").value);
        const unit = row.querySelector(".ingredient-unit").value;
        if (!name || isNaN(qty) || qty <= 0 || !unit) {
          alert("Please enter valid ingredient details.");
          return;
        }
        ingredients.push({ name, qty, unit });
      }
      let bomMasters = fetchFoodItems();
      const key = currentEditKey ? currentEditKey : foodItemName.toLowerCase();
      bomMasters[key] = { foodItem: foodItemName, baseQty: baseQty, baseUOM: baseUOM, ingredients: ingredients };
      saveBOMMasters(bomMasters);
      alert("Food Item Master saved successfully!");
      document.getElementById("bom-master-form").reset();
      resetIngredients();
      document.getElementById("bom-form-section").classList.add("hidden");
      document.getElementById("items-list-view").classList.remove("hidden");
      refreshBOMList();
      // Refresh Kitchen dropdowns so that new items appear
      populateFoodItems();
      populateCookFoodItems();
      // Refresh Process Master dropdown as well
      populateProcessFoodItems();
      currentEditKey = null;
    });
    document.querySelector("#bom-list-table tbody").addEventListener("click", function(event) {
      const target = event.target;
      if (target.classList.contains("edit-btn")) {
        const key = target.getAttribute("data-key");
        const bomMasters = fetchFoodItems();
        const bom = bomMasters[key];
        if (bom) {
          currentEditKey = key;
          document.getElementById("form-title").innerText = "Edit Food Item Master";
          document.getElementById("foodItemName").value = bom.foodItem;
          document.getElementById("baseQty").value = bom.baseQty;
          document.getElementById("baseUOM").value = bom.baseUOM;
          const container = document.getElementById("ingredients-container");
          container.innerHTML = "<h3>Ingredients</h3>";
          bom.ingredients.forEach(ing => {
            const row = createIngredientRow();
            row.querySelector(".ingredient-name").value = ing.name;
            row.querySelector(".ingredient-qty").value = ing.qty;
            const select = row.querySelector(".ingredient-unit");
            select.innerHTML = `<option value="">Select UOM</option>` +
              fetchUOMList().map(uom => `<option value="${uom}" ${ing.unit===uom?"selected":""}>${uom}</option>`).join("");
            container.appendChild(row);
          });
          document.getElementById("items-list-view").classList.add("hidden");
          document.getElementById("bom-form-section").classList.remove("hidden");
        }
      } else if (target.classList.contains("delete-btn")) {
        const key = target.getAttribute("data-key");
        if (confirm("Are you sure you want to delete this Food Item Master?")) {
          let bomMasters = fetchFoodItems();
          delete bomMasters[key];
          saveBOMMasters(bomMasters);
          refreshBOMList();
          // Refresh Kitchen dropdowns too
          populateFoodItems();
          populateCookFoodItems();
          populateProcessFoodItems();
        }
      }
    });
    
    /* ------------------ Admin: UOM Management ------------------ */
  
    document.getElementById("uom-form").addEventListener("submit", function(event) {
      event.preventDefault();
      const newUOM = document.getElementById("new-uom").value.trim();
      if (!newUOM) { alert("Enter a valid UOM."); return; }
      const uomList = fetchUOMList();
      if (uomList.includes(newUOM)) { alert("UOM already exists!"); return; }
      uomList.push(newUOM);
      saveUOMList(uomList);
      document.getElementById("new-uom").value = "";
      renderUOMList();
    });
    
    /* ------------------ Admin: Process Masters Management ------------------ */
    let currentProcessKey = null;
    // Populate the Process Master Food Item dropdown from BOM masters
    function populateProcessFoodItems() {
      const bomMasters = fetchFoodItems();
      const select = document.getElementById("processFoodItem");
      select.innerHTML = `<option value="">Select Food Item</option>`;
      for (const key in bomMasters) {
        if (bomMasters.hasOwnProperty(key)) {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = bomMasters[key].foodItem;
          select.appendChild(option);
        }
      }
    }
    
     document.getElementById("show-add-process").addEventListener("click", function() {
      currentProcessKey = null;
      document.getElementById("process-form-title").innerText = "Add New Process Master";
      populateProcessFoodItems();
      document.getElementById("admin-process-section").classList.add("hidden");
      document.getElementById("process-form-section").classList.remove("hidden");
      document.getElementById("process-master-form").reset();
      resetProcessSteps();
    });
    document.getElementById("cancel-add-process").addEventListener("click", function() {
      document.getElementById("process-master-form").reset();
      resetProcessSteps();
      document.getElementById("process-form-section").classList.add("hidden");
      document.getElementById("admin-process-section").classList.remove("hidden");
      currentProcessKey = null;
    });
    function resetProcessSteps() {
      const container = document.getElementById("process-steps-container");
      container.innerHTML = `
        <h3>Process Steps</h3>
        <div class="process-step-row">
          <input type="text" class="process-step" placeholder="Step description" required>
          <button type="button" class="remove-process-step">Remove</button>
        </div>
      `;
      container.querySelector(".remove-process-step").addEventListener("click", function() {
        const row = this.closest(".process-step-row");
        if(row) row.remove();
      });
    }
    document.getElementById("add-process-step").addEventListener("click", function() {
      const container = document.getElementById("process-steps-container");
      const newRow = document.createElement("div");
      newRow.className = "process-step-row";
      newRow.innerHTML = `
        <input type="text" class="process-step" placeholder="Step description" required>
        <button type="button" class="remove-process-step">Remove</button>
      `;
      newRow.querySelector(".remove-process-step").addEventListener("click", function() {
        newRow.remove();
      });
      container.appendChild(newRow);
    });
    document.getElementById("process-master-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const foodItem = document.getElementById("processFoodItem").value.trim().toLowerCase();
      if (!foodItem) {
        alert("Please select a Food Item from the dropdown.");
        return;
      }
      const stepInputs = document.querySelectorAll(".process-step");
      let steps = [];
      stepInputs.forEach(input => {
        const text = input.value.trim();
        if (text) steps.push(text);
      });
      if (steps.length === 0) {
        alert("Please enter at least one process step.");
        return;
      }
      let processMasters = fetchProcessMasters();
      processMasters[foodItem] = { processes: steps };
      saveProcessMasters(processMasters);
      alert("Process Master saved for " + foodItem);
      document.getElementById("process-master-form").reset();
      resetProcessSteps();
      document.getElementById("process-form-section").classList.add("hidden");
      document.getElementById("admin-process-section").classList.remove("hidden");
      renderProcessMasters();
      populateFoodItems();
      populateCookFoodItems();
      populateProcessFoodItems();
      currentProcessKey = null;
    });
    document.getElementById("process-table").addEventListener("click", function(e) {
      const target = e.target;
      if (target.classList.contains("edit-btn")) {
        const key = target.getAttribute("data-key");
        const processMasters = fetchProcessMasters();
        const proc = processMasters[key];
        if (proc) {
          currentProcessKey = key;
          document.getElementById("process-form-title").innerText = "Edit Process Master";
          populateProcessFoodItems();
          document.getElementById("processFoodItem").value = key;
          const container = document.getElementById("process-steps-container");
          container.innerHTML = "<h3>Process Steps</h3>";
          proc.processes.forEach(step => {
            const row = document.createElement("div");
            row.className = "process-step-row";
            row.innerHTML = `
              <input type="text" class="process-step" placeholder="Step description" required value="${step}">
              <button type="button" class="remove-process-step">Remove</button>
            `;
            row.querySelector(".remove-process-step").addEventListener("click", function() {
              row.remove();
            });
            container.appendChild(row);
          });
          document.getElementById("admin-process-section").classList.add("hidden");
          document.getElementById("process-form-section").classList.remove("hidden");
        }
      } else if (target.classList.contains("delete-btn")) {
        const key = target.getAttribute("data-key");
        if (confirm("Are you sure you want to delete this Process Master?")) {
          let processMasters = fetchProcessMasters();
          delete processMasters[key];
          saveProcessMasters(processMasters);
          renderProcessMasters();
          populateProcessFoodItems();
          populateFoodItems();
          populateCookFoodItems();
        }
      }
    });
    
    /* ------------------ Kitchen Section ------------------ */
    document.getElementById("kitchen-itemlist-btn").addEventListener("click", function() {
      this.classList.add("active");
      document.getElementById("kitchen-cook-btn").classList.remove("active");
      document.getElementById("kitchen-calc-section").classList.remove("hidden");
      document.getElementById("kitchen-cook-section").classList.add("hidden");
    });
    document.getElementById("kitchen-cook-btn").addEventListener("click", function() {
      this.classList.add("active");
      document.getElementById("kitchen-itemlist-btn").classList.remove("active");
      document.getElementById("kitchen-calc-section").classList.add("hidden");
      document.getElementById("kitchen-cook-section").classList.remove("hidden");
      populateCookFoodItems();
    });
    document.getElementById("bom-calc-form").addEventListener("submit", function(event) {
      event.preventDefault();
      const foodItemKey = document.getElementById("foodItemSelect").value;
      const prodQty = parseFloat(document.getElementById("prodQty").value);
      if (!foodItemKey) { alert("Please select a food item."); return; }
      if (isNaN(prodQty) || prodQty <= 0) { alert("Please enter a valid production quantity."); return; }
      const bomMasters = fetchFoodItems();
      const bom = bomMasters[foodItemKey];
      if (!bom) { alert("Food Item Master not found."); return; }
      const factor = prodQty / bom.baseQty;
      let resultHTML = `<h2>Item list for ${bom.foodItem} (${prodQty} ${bom.baseUOM})</h2>`;
      resultHTML += `<table>
          <thead>
            <tr>
              <th>Ingredient</th>
              <th>Quantity</th>
              <th>Unit</th>
            </tr>
          </thead>
          <tbody>`;
      bom.ingredients.forEach(ing => {
        const scaledQty = ing.qty * factor;
        resultHTML += `<tr>
              <td>${ing.name}</td>
              <td>${scaledQty.toFixed(2)}</td>
              <td>${ing.unit}</td>
            </tr>`;
      });
      resultHTML += `</tbody></table>`;
      document.getElementById("bom-result").innerHTML = resultHTML;
      document.getElementById("share-container").classList.remove("hidden");
      document.getElementById("share-options").classList.add("hidden");
    });
    document.getElementById("share-btn").addEventListener("click", function() {
      document.getElementById("share-options").classList.toggle("hidden");
    });
    document.getElementById("share-whatsapp").addEventListener("click", function() {
      const shareText = document.getElementById("bom-result").innerText;
      const url = "https://api.whatsapp.com/send?text=" + encodeURIComponent(shareText);
      window.open(url, "_blank");
    });
    document.getElementById("print-bom").addEventListener("click", function() {
      window.print();
    });
    function populateFoodItems() {
  getDocs(collection(db, "food_items")).then((querySnapshot) => {
    const select = document.getElementById("foodItemSelect");
    select.innerHTML = `<option value="">Select Food Item</option>`;
    
    querySnapshot.forEach((doc) => {
      const option = document.createElement("option");
      option.value = doc.id;
      option.textContent = doc.data().name;
      select.appendChild(option);
    });
  });
}

    function populateCookFoodItems() {
      const bomMasters = fetchFoodItems();
      const select = document.getElementById("cookFoodItem");
      select.innerHTML = `<option value="">Select Food Item</option>`;
      for (const key in bomMasters) {
        if (bomMasters.hasOwnProperty(key)) {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = bomMasters[key].foodItem;
          select.appendChild(option);
        }
      }
    }
    document.getElementById("foodItemSelect").addEventListener("change", function() {
      const selectedKey = this.value;
      const prodQtyLabel = document.getElementById("prodQty-label");
      if (selectedKey) {
        const bom = fetchFoodItems()[selectedKey];
        if (bom) { prodQtyLabel.innerText = `Enter Production Quantity (in ${bom.baseUOM}):`; }
      } else { prodQtyLabel.innerText = "Enter Production Quantity:"; }
    });
    document.getElementById("cookFoodItem").addEventListener("change", function() {
      const selectedKey = this.value;
      const cookUOMSpan = document.getElementById("cookUOM");
      if (selectedKey) {
        const bom = fetchFoodItems()[selectedKey];
        cookUOMSpan.innerText = bom ? bom.baseUOM : "";
      } else { cookUOMSpan.innerText = ""; }
    });
    
    /* ------------------ Kitchen: Cook Food Functionality ------------------ */
    // For each process step, create a row with Start and Stop buttons.
    // Elapsed time is recorded for each step and summed up.
    function updateTotalCookingTime() {
      const rows = document.querySelectorAll("#process-steps-body tr");
      let total = 0;
      rows.forEach(row => {
        const timeSpan = row.querySelector(".step-time");
        const timeVal = parseFloat(timeSpan.innerText);
        if (!isNaN(timeVal)) total += timeVal;
      });
      document.getElementById("total-cook-time").innerText = `Total Cooking Time: ${total.toFixed(1)} sec`;
    }
    
    document.getElementById("cook-form").addEventListener("submit", function(event) {
      event.preventDefault();
      const foodItemKey = document.getElementById("cookFoodItem").value;
      const cookQty = parseFloat(document.getElementById("cookQty").value);
      if (!foodItemKey) { alert("Please select a food item."); return; }
      if (isNaN(cookQty) || cookQty <= 0) { alert("Please enter a valid quantity."); return; }
      const processMasters = fetchProcessMasters();
      const proc = processMasters[foodItemKey];
      if (!proc) { alert("No cooking process defined for this food item."); return; }
      const tbody = document.getElementById("process-steps-body");
      tbody.innerHTML = "";
      // For each step, create a row with: Process Step, Start button, Stop button, Time Taken
      proc.processes.forEach((step, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${step}</td>
          <td><button class="start-btn">Start</button></td>
          <td><button class="stop-btn" disabled>Stop</button></td>
          <td><span class="step-time"></span></td>
        `;
        const startBtn = tr.querySelector(".start-btn");
        const stopBtn = tr.querySelector(".stop-btn");
        const timeSpan = tr.querySelector(".step-time");
        // When Start is clicked, record start time in this row's dataset and disable Start, enable Stop
        startBtn.addEventListener("click", function() {
          tr.dataset.startTime = Date.now();
          startBtn.disabled = true;
          stopBtn.disabled = false;
          // Change color to indicate active start (optional)
          startBtn.style.backgroundColor = "#6c757d";
        });
        // When Stop is clicked, calculate elapsed time and update the time cell; disable Stop.
        stopBtn.addEventListener("click", function() {
          const startTime = parseInt(tr.dataset.startTime);
          if (!startTime) { alert("Please click Start first."); return; }
          const elapsed = Date.now() - startTime;
          const seconds = (elapsed / 1000).toFixed(1);
          timeSpan.innerText = seconds;
          stopBtn.disabled = true;
          // Change color to indicate stop (optional)
          stopBtn.style.backgroundColor = "#6c757d";
          updateTotalCookingTime();
        });
        tbody.appendChild(tr);
      });
      document.getElementById("total-cook-time").innerText = "Total Cooking Time: 0.0 sec";
      document.getElementById("process-display").classList.remove("hidden");
    });
    
    document.getElementById("cook-share-btn").addEventListener("click", function() {
      const options = document.getElementById("cook-share-options");
      options.classList.toggle("hidden");
    });
    document.getElementById("cook-share-whatsapp").addEventListener("click", function() {
      const rows = Array.from(document.querySelectorAll("#process-steps-body tr")).map(tr => {
        const stepText = tr.cells[0].innerText;
        const timeText = tr.cells[3].innerText;
        return `${stepText} - ${timeText} sec`;
      }).join("\n");
      const totalTime = document.getElementById("total-cook-time").innerText;
      const shareText = `Cooking Process:\n${rows}\n${totalTime}`;
      const url = "https://api.whatsapp.com/send?text=" + encodeURIComponent(shareText);
      window.open(url, "_blank");
    });
    document.getElementById("cook-print").addEventListener("click", function() {
      window.print();
    });
    document.getElementById("back-to-kitchen-menu").addEventListener("click", function() {
      document.getElementById("process-display").classList.add("hidden");
      document.getElementById("cook-form").reset();
      document.getElementById("kitchen-calc-section").classList.remove("hidden");
      document.getElementById("kitchen-cook-section").classList.add("hidden");
      document.getElementById("kitchen-itemlist-btn").classList.add("active");
      document.getElementById("kitchen-cook-btn").classList.remove("active");
      document.getElementById("total-cook-time").innerText = "Total Cooking Time: 0.0 sec";
    });
    
    /* ------------------ Kitchen: Clear Cache & Logout ------------------ */
    document.getElementById("clear-cache-kitchen").addEventListener("click", function() {
      if (confirm("This will clear all stored Food Item Masters. Continue?")) {
        localStorage.removeItem("bomMasters");
        location.reload();
      }
    });
    document.getElementById("kitchen-logout-btn").addEventListener("click", function() { location.reload(); });
  </script>
</body>
</html>
